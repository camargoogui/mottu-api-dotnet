# üóÑÔ∏è INSTRU√á√ïES PARA CONFIGURA√á√ÉO DO BANCO DE DADOS

## üìã Status das Migrations

‚úÖ **Migrations criadas com sucesso!**
- **InitialCreate**: `20250919122909_InitialCreate.cs` - Cria√ß√£o inicial das tabelas
- **AddMotoStatus**: `20250919143023_AddMotoStatus.cs` - Adiciona campo Status na tabela Motos
- **FixValorTotalNullable**: `20250923121835_FixValorTotalNullable.cs` - Corrige ValorTotal para nullable
- **Status**: Todas as migrations aplicadas no banco

## üöÄ Como Executar as Migrations

### **Op√ß√£o 1: Executar via EF Core (Recomendado)**
```bash
# Navegar para a pasta Presentation
cd MottuApi/MottuApi.Presentation

# Aplicar migrations
dotnet ef database update
```

### **Op√ß√£o 2: Executar Script SQL Manual**
Se o Oracle n√£o estiver acess√≠vel via EF Core, execute o script SQL manual:

1. **Conectar ao Oracle** usando SQL Developer, SQL*Plus ou similar
2. **Executar o script**: `script_oracle.sql`
3. **Verificar cria√ß√£o** das tabelas

## üìä Estrutura das Tabelas Criadas

### **Tabela: Filiais**
```sql
CREATE TABLE Filiais (
    Id NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Nome NVARCHAR2(100) NOT NULL,
    Endereco_Logradouro NVARCHAR2(100) NOT NULL,
    Endereco_Numero NVARCHAR2(10) NOT NULL,
    Endereco_Complemento NVARCHAR2(50),
    Endereco_Bairro NVARCHAR2(50) NOT NULL,
    Endereco_Cidade NVARCHAR2(50) NOT NULL,
    Endereco_Estado NVARCHAR2(2) NOT NULL,
    Endereco_CEP NVARCHAR2(8) NOT NULL,
    Telefone NVARCHAR2(15) NOT NULL,
    Ativo NUMBER(1) DEFAULT 1 NOT NULL,
    DataCriacao TIMESTAMP(7) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    DataAtualizacao TIMESTAMP(7)
);
```

### **Tabela: Motos**
```sql
CREATE TABLE Motos (
    Id NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Placa NVARCHAR2(7) NOT NULL,
    Modelo NVARCHAR2(50) NOT NULL,
    Ano NUMBER(10) NOT NULL,
    Cor NVARCHAR2(30) NOT NULL,
    Status NUMBER(10) DEFAULT 0 NOT NULL,
    DataCriacao TIMESTAMP(7) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    DataAtualizacao TIMESTAMP(7),
    FilialId NUMBER(10) NOT NULL,
    CONSTRAINT FK_Motos_Filiais_FilialId 
        FOREIGN KEY (FilialId) 
        REFERENCES Filiais(Id) 
        ON DELETE RESTRICT
);
```

### **Tabela: Loca√ß√µes**
```sql
CREATE TABLE Locacoes (
    Id NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MotoId NUMBER(10) NOT NULL,
    FilialId NUMBER(10) NOT NULL,
    ClienteNome NVARCHAR2(100) NOT NULL,
    ClienteCpf NVARCHAR2(11) NOT NULL,
    ClienteTelefone NVARCHAR2(15) NOT NULL,
    DataInicio TIMESTAMP(7) NOT NULL,
    DataFim TIMESTAMP(7),
    ValorHora NUMBER(10,2) NOT NULL,
    ValorTotal NUMBER(10,2),
    Status NUMBER(10) DEFAULT 1 NOT NULL,
    DataCriacao TIMESTAMP(7) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    DataAtualizacao TIMESTAMP(7),
    CONSTRAINT FK_Locacoes_Motos_MotoId 
        FOREIGN KEY (MotoId) 
        REFERENCES Motos(Id) 
        ON DELETE RESTRICT,
    CONSTRAINT FK_Locacoes_Filiais_FilialId 
        FOREIGN KEY (FilialId) 
        REFERENCES Filiais(Id) 
        ON DELETE RESTRICT
);
```

## üîß Configura√ß√£o da String de Conex√£o

Verifique se a string de conex√£o est√° correta no `appsettings.json`:

```json
{
  "ConnectionStrings": {
    "OracleConnection": "User Id=SEU_USUARIO;Password=SUA_SENHA;Data Source=oracle.fiap.com.br:1521/ORCL;"
  }
}
```

## üß™ Dados de Exemplo

O projeto n√£o inclui dados de exemplo por padr√£o. Para testar a API:

1. **Criar uma filial** via POST `/api/filial`
2. **Criar uma moto** via POST `/api/moto` 
3. **Criar uma loca√ß√£o** via POST `/api/locacao`

### **Exemplo de Dados para Teste**
```json
// Filial
{
  "nome": "Filial S√£o Paulo",
  "logradouro": "Rua das Flores",
  "numero": "123",
  "complemento": "Sala 1",
  "bairro": "Centro",
  "cidade": "S√£o Paulo",
  "estado": "SP",
  "cep": "01234567",
  "telefone": "(11) 99999-9999"
}

// Moto
{
  "placa": "ABC1234",
  "modelo": "Honda CG 160",
  "ano": 2023,
  "cor": "Vermelha",
  "filialId": 1
}
```

## üÜï Novas Funcionalidades Implementadas

### **Pagina√ß√£o**
- Todos os endpoints de listagem suportam pagina√ß√£o
- Par√¢metros: `?page=1&pageSize=10`
- Resposta inclui metadados de pagina√ß√£o

### **HATEOAS**
- Links de navega√ß√£o em todas as respostas
- Facilita descoberta da API
- Melhora experi√™ncia do desenvolvedor

### **Valida√ß√µes**
- Data Annotations para valida√ß√£o de modelos
- Valida√ß√£o autom√°tica de campos obrigat√≥rios
- Mensagens de erro detalhadas

## ‚úÖ Verifica√ß√£o

Ap√≥s executar o script, verifique se as tabelas foram criadas:

```sql
-- Verificar tabelas
SELECT table_name FROM user_tables WHERE table_name IN ('FILIAIS', 'MOTOS', 'LOCACOES');

-- Verificar dados
SELECT 'Filiais' as Tabela, COUNT(*) as Registros FROM Filiais
UNION ALL
SELECT 'Motos' as Tabela, COUNT(*) as Registros FROM Motos
UNION ALL
SELECT 'Locacoes' as Tabela, COUNT(*) as Registros FROM Locacoes;

-- Verificar estrutura da tabela Motos (Status)
SELECT column_name, data_type, nullable FROM user_tab_columns 
WHERE table_name = 'MOTOS' AND column_name = 'STATUS';

-- Verificar estrutura da tabela Locacoes (ValorTotal nullable)
SELECT column_name, data_type, nullable FROM user_tab_columns 
WHERE table_name = 'LOCACOES' AND column_name = 'VALORTOTAL';
```

## üö® Solu√ß√£o de Problemas

### **Erro de Conex√£o Oracle**
- Verifique se o Oracle est√° rodando
- Confirme a string de conex√£o
- Teste a conex√£o com SQL Developer

### **Erro de Permiss√µes**
- Execute como usu√°rio com privil√©gios DDL
- Verifique se o usu√°rio tem permiss√£o para criar tabelas

### **Erro de Espa√ßo**
- Verifique se h√° espa√ßo suficiente no tablespace
- Execute `SELECT * FROM user_tablespaces;`

## üéØ Pr√≥ximos Passos

1. ‚úÖ Executar migrations via EF Core
2. ‚úÖ Testar conex√£o da API
3. ‚úÖ Executar aplica√ß√£o
4. ‚úÖ Testar endpoints via Swagger
5. ‚úÖ Criar dados de teste via API

## üìä Status Atual do Projeto

- ‚úÖ **3 Migrations aplicadas** no banco Oracle
- ‚úÖ **3 Tabelas criadas**: Filiais, Motos, Locacoes
- ‚úÖ **31 Endpoints funcionando** (7 Filiais + 9 Motos + 15 Loca√ß√µes)
- ‚úÖ **Pagina√ß√£o e HATEOAS** implementados
- ‚úÖ **ValorTotal nullable** corrigido

---

**Status**: ‚úÖ Projeto 100% funcional e migrations aplicadas!
